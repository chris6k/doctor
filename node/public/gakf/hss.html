<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0 user-scalable=yes"/>
	<title>膝关节HHS评分</title>
	<link rel="stylesheet" type="text/css" href="./static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="./static/css/index.css">
	<script type="text/javascript" src="./static/js/require.js"></script>
	<script type="text/javascript" src="./static/js/main.js"></script>
</head>
<body ms-controller="test" class="ms-controller">
	<div class="" id="gradeList">
		<nav class="navbar navbar-default navbar-fixed-top my-nav my-nav-top">
		  <div id="my-tab">
		    <div class="col-xs-6 text-center my-nav-line selected">
		    	<a href="">左腿</a>
		    </div>
		    <div class="col-xs-6 text-center my-nav-line">
		    	<a href="">右腿</a>
		    </div>
		  </div>
		</nav>
		<div style="margin-top:45px;"></div>
		<span style="margin: 10px;display: inline-block;">{{d.summary}}</span>
		<div  ms-repeat-el="d.items"  ms-attr-alt="{{$index}}">
			<span style="margin: 10px;display: inline-block;">{{el.title}}</span>
			<ul class="list-group " ms-if="el.type == 'checkbox'">
			  <li class="list-group-item checkbox" ms-repeat-el="el.keys"  ms-click="click">
			  	<div class="col-xs-8">
			  		<span class="qtitle">{{el.key}}</span>
			  	</div>
			  	<div class="col-xs-4">
			  		<span ms-attr-alt= "{{el.value}}" class="tag"></span>
		  			<span class="right tagcon sl8"></span>
			  	</div>
			  </li>
			</ul>
			<ul class="list-group " ms-if="el.type == 'input'" >
			  <li class="list-group-item " ms-repeat-el="el.keys" >
			  	<div class="col-xs-8">
			  		<span class="qtitle">{{el.key}}</span>
			  	</div>
			  	<div class="col-xs-4">
			  		<input type="text" value="" style="width:100%" class="inputvalue" placeholder="请输入" ms-blur="blur" >
			  	</div>
			  </li>
			</ul>
		</div>
	</div>
	<nav class="navbar navbar-default navbar-fixed-bottom my-nav my-nav-bottom"  ms-if="d.isshow">
	  <div class="container text-center" style="height: 42px; line-height: 42px;">
	    <div class="row">
	    	<div class="col-xs-12">
	    		<a ms-href="">
			    	<span style="color:#fff;">保存</span>
			    </a>
	    	</div>
	    </div>
	  </div>
	</nav>
	<script type="text/javascript">
		require(["store","avalon"],function(store){
			function selected(obj,type){
				var t = "yellowtag",type = !type?0:type;
				if(!$(obj).data("isSelected")){
					$(obj).addClass("selected");
					$(obj).find(".tag").addClass(t);
					$(obj).find(".tagcon").html("+"+type+"分");
					$(obj).data("isSelected",true);
				}else{
					$(obj).removeClass("selected");
					$(obj).find(".tag").removeClass(t);
					$(obj).data("isSelected",false);
					$(obj).find(".tagcon").html("");
				}	
			}
			$("#gradeList").on("touchstart",".checkbox",function(){
				var temp = $(this).find(".tag");
				selected(this,temp.attr("alt"));
			});

			var data = {
				title:"量表标题",
				summary:"点击选择一个月内患者有过的情况:",
				items:[{
				 title:"一、行走疼痛（总分30分）",
				 summary:"", 
				 type:"checkbox", 
				 keys:[{key:"行走时无疼痛",value:"15"},
				 	   {key:"行走时轻度疼痛",value:"10"},
				 	   {key:"行走时中度疼痛",value:"5"},
				 	   {key:"行走时严重疼痛",value:"0"}], 
				 value:["行走时无疼痛","行走时轻度疼痛"],
				 scored:true,
				 checkedStyle:"dot"
				},
				{
				 title:"二、休息疼痛（总分30分）",
				 summary:"", 
				 type:"checkbox", 
				 keys:[{key:"休息时无疼痛",value:"15"},
				 	   {key:"休息时轻度疼痛",value:"10"},
				 	   {key:"休息时中度疼痛",value:"5"},
				 	   {key:"休息时严重疼痛",value:"0"}], 
				 value:[],
				 scored:true,
				 checkedStyle:"dot"
				},{
				 title:"三、行走功能（总分22分）",
				 summary:"", 
				 type:"checkbox", 
				 keys:[{key:"行走站立无限制",value:"12"},
				 	   {key:"行走2500～5000米和站立半小时以上",value:"10"},
				 	   {key:"行走500～2500米和站立可达半小时",value:"5"},
				 	   {key:"行走少于500米",value:"4"},
				 	   {key:"能上楼梯，但需支具",value:"2"},
				 	   {key:"屋内行走，无需支具",value:"5"},
				 	   {key:"屋内行走，需要支具",value:"2"},
				 	   {key:"不能行走",value:"0"}
				 	   ], 
				 value:[],
				 scored:true,
				 checkedStyle:"dot"
				},{
				 title:"四、活动度（总分18分）",
				 summary:"", 
				 type:"input", 
				 keys:[{key:"每活动8度得1分（最高18分）",value:"18"}], 
				 value:[],
				 scored:true,
				 checkedStyle:"none"
				}
				]
			};
			 //sick has save btn doctor hasn't save btn
			var temp = store.get("user"),id="";
			if(temp.type =="doctor"){
				data.isshow = false;
			}else {
				data.isshow = true;
			}

		    var vmodel =avalon.define({
		          $id: "test",
		          d:data,
		          click:function(e){
		          	var list = $(this).parent().find(".selected .qtitle"),value = $(this).parent().parent().find(".keys"),temp=[],index = $(this).parent().parent().attr("alt");
		          	for(var i=0;i<list.length;i++){
		          		temp.push($(list[i]).html());
		          	}
		          	vmodel.d.items[index].value = temp;
		          	console.log(vmodel.d.$model);
		          },
		          blur:function(){
		          	var temp=[],index = $(this).parent().parent().parent().parent().attr("alt");
		          	temp.push($(this).val());
		          	vmodel.d.items[index].value = temp;
		          	console.log(vmodel.d.$model);
		          }
		    });
		    avalon.scan();
		    for(var i=0;i<data.items.length;i++){
		    	var temp = data.items[i];
		    	if(temp.type == "checkbox"){
			    	for(var j = 0;j<temp.value.length;j++){
			    		$("span:contains("+temp.value[j]+")").parent().parent().trigger("touchstart");
			    	}
		    	}else if(temp.type == "input"){
		    		for(var j = 0;j<temp.keys.length;j++){
			    		$("span:contains("+temp.keys[j].key+")").parent().parent().find(".inputvalue").val(temp.value[j]);
			    	}
		    	}
		    }

		   

		});
	</script>
</body>
</html>