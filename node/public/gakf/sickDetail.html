<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width,initial-scale=1.0 user-scalable=yes"/>
	<title>患者信息</title>
	<link rel="stylesheet" type="text/css" href="./static/css/bootstrap.min.css">
	<link rel="stylesheet" type="text/css" href="./static/css/index.css">
	<script type="text/javascript" src="./static/js/require.js"></script>
	<script type="text/javascript" src="./static/js/main.js"></script>
	<script type="text/javascript" src="./static/js/resource.js"></script>
	<style type="text/css">
	.text-center .row div{
		padding:0px;
		text-align: content;
	}
	</style>
</head>
<body ms-controller="test" class="ms-controller">

	<div class="container">
		<ul class="list-group">
		  <li class="list-group-item">
		  	<span>主治医生</span>
		  	<span class="right">{{d.doctor_name}}</span>
		  </li>
		</ul>
		<div class="spacer10"></div>
		<span style="padding:5px 0px;display: inline-block;">患者基本信息（患者填写）</span>
		<ul class="list-group">
		  <li class="list-group-item gray">
		  	<span>患者姓名</span>
		  	<span class="right">{{d.name}}</span>
		  </li>
		  <li class="list-group-item">
		  	<span>年龄</span>
		  	<span class="right">{{d.age}}岁</span>
		  </li>
		  <li class="list-group-item gray">
		  	<span>身高</span>
		  	<span class="right">{{d.height}}cm</span>
		  </li>
		  <li class="list-group-item">
		  	<span>体重</span>
		  	<span class="right">{{d.weight}}kg</span>
		  </li>
		  <li class="list-group-item gray">
		  	<span>性别</span>
		  	<span class="right">{{d.gender}}</span>
		  </li>
		  <li class="list-group-item">
		  	<span>手术类型</span>
		  	<span class="right">{{d.operate_type}}</span>
		  </li>
		  <li class="list-group-item gray">
		  	<span>护理级别</span>
		  	<span class="right">{{d.care_level}}</span>
		  </li>
		  <li class="list-group-item">
		  	<span>床号</span>
			<span class="right">{{d.bed_id}}</span>
		  </li>
		</ul>
		
		<span style="padding:5px 0px;display: inline-block;">患者自评量表（患者填写）</span>
		<ul class="list-group">
			<li class="list-group-item">
		  		<a ms-href="/gakf/rapt.html?sick_id={{d.sickId}}">
  			  		<span>VTE评分</span>
  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
  					<span class="right orange sl8" ms-if="d.caprini!=''">{{d.caprini}}</span>
  					<span class="right orange sl8" ms-if="d.rapt!=''">{{d.rapt}}</span>
  					<span class="right orange sl8" ms-if="d.caprini == ''&& d.rapt==''">无评分</span>
		  		</a>
		 	</li>
		 	
		 	<li class="list-group-item">
		  		<a ms-href="/gakf/cxgwpg.html?sick_id={{d.sickId}}">
  			  		<span>出血评估 </span>
  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
  					<span class="right orange sl8" ms-if="d.cxpg!=''">{{d.cxpg}}</span>
  					<span class="right orange sl8" ms-if="!d.cxpg">2项目出血风险</span>
		  		</a>
		 	</li>
		</ul>
		<span style="padding:5px 0px;display: inline-block;">安全用药</span>
		<ul class="list-group">
			<!-- <li class="list-group-item">
		  		<a ms-href="/gakf/taboos.html?sick_id={{d.sickId}}">
  			  		<span>安全用药量表</span>
  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
  					<span class="right orange sl8" ms-if="d.select_count!=''">共 {{d.select_count}} 项用药禁忌</span>
  					<span class="right orange sl8" ms-if="!d.select_count">无用药禁忌</span>
		  		</a>
		 	</li> -->
		 	<li class="list-group-item">
		  		<a ms-href="/gakf/recommend.html?sick_id={{d.sickId}}">
  			  		<span>安全用药建议 </span>
  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
  					<span class="right orange sl8" ms-if="d.drug_count!=''">共 {{d.drug_count}} 条建议</span>
  					<span class="right orange sl8" ms-if="!d.drug_count">无建议</span>
		  		</a>
		 	</li>
		</ul>
		<div ms-visible="d.isvisible">
			<span style="padding:5px 0px;display: inline-block;">长期登记量表（医生填写）</span>
			<ul class="list-group">
				<li class="list-group-item gray">
				  	<span>入院日期</span>
				  	<input class="right text-right my-input1 gray" ms-duplex="d.in_day" >
				</li>
				<li class="list-group-item">
				  	<span>出院日期</span>
					<input class="right text-right my-input1" ms-duplex="d.out_day" >
				</li>
				
				<li class="list-group-item">
			  		<a ms-href="/gakf/before.html?sick_id={{d.sickId}}">
	  			  		<span>术前骨科筛查量表</span>
	  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
  						<span class="right orange sl8">点击填写</span>
			  		</a>
			 	</li>
			 	<li class="list-group-item">
			  		<a ms-href="/gakf/between.html?sick_id={{d.sickId}}">
	  			  		<span>术中骨科筛查量表</span>
	  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
	  					<span class="right orange sl8">点击填写</span>
			  		</a>
			 	</li>
			 	<li class="list-group-item">
			  		<a ms-href="/gakf/after.html?sick_id={{d.sickId}}">
	  			  		<span>术后骨科筛查量表</span>
	  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
	  					<span class="right orange sl8">点击填写</span>
			  		</a>
			 	</li>
			 	<li class="list-group-item">
			  		<a ms-href="/gakf/hss_left.html?sick_id={{d.sickId}}">
	  			  		<span>膝关节HSS评分 </span>
	  					<span class="right glyphicon glyphicon-chevron-right gray_arrow"></span>
	  					<span class="right orange sl8" ms-if="d.hss!=''">{{d.hss}}</span>
	  					<span class="right orange sl8" ms-if="!d.hss">点击填写</span>
			  		</a>
			 	</li>
			</ul>
		</div>
	</div>
	<nav class="navbar navbar-default navbar-fixed-bottom my-nav my-nav-bottom" ms-visible="d.isvisible" ms-if="d.isout">
	  <div class="container text-center" style="height: 42px; line-height: 42px;">
	    <div class="row">
	    	<div class="col-xs-12">
	    		<a ms-href="/gakf/flow.html?sick_id={{d.id}}&doctor_id={{d.doctor_id}}&isout={{d.isout}}">
			    	<span style="color:#fff;">随访</span>
			    </a>
	    	</div>
	    </div>
	  </div>
	</nav>
	<nav class="navbar navbar-default navbar-fixed-bottom my-nav my-nav-bottom" ms-visible="d.isvisible" ms-if="!d.isout">
	  <div class="container text-center" style="height: 42px; line-height: 42px;">
	    <div class="row">
	    	<div class="col-xs-4">
	    		<span style="color:#fff;" ms-click="save">保存</span>
	    	</div>
	    	<!-- <div class="col-xs-3">
	    		<a href="javascript:void(0)">
			    	<span style="color:#fff;">联系患者</span>
			    </a>
	    	</div> -->
	    	<div class="col-xs-4">

	    		<a ms-href="/gakf/check.html?sick_id={{d.sickId}}&doctor_id={{d.doctor_id}}">
			    	<span style="color:#fff;" >诊疗记录</span>
			    </a>
	    	</div>
	    	<div class="col-xs-4">

	    		<a ms-href="/gakf/print.html?sick_id={{d.sickId}}&doctor_id={{d.doctor_id}}">
			    	<span style="color:#fff;" >打印床头卡</span>
			    </a>
	    	</div>
	    </div>
	  </div>
	</nav>
	<div  id ="commesCom" style="display:none;" class=" alert alert-success" role="alert"></div>
	<script type="text/javascript">
		require(["store","avalon"],function(store){
				var data={isvisible:false,
						  caprini:'',
						  rapt:'',
						isout:Boolean(RC.parseOptions(window.location.href).isout)||false},temp=store.get("user"),id;
				if(temp.type=="sick"){
					id = temp.id;
				}else if(temp.type == "doctor"){
					id = RC.parseOptions(window.location.href).id;
					data.isvisible = true;
				}
				data.sickId = id;
				
			    var vmodel = avalon.define({
			          $id: "test",
			          d:data,
			           save:function(){
			          	var d = JSON.stringify(vmodel.d.$model);
			          	$.ajax({
			          		type:"post",
							url: "/sick/create",
							dataType: "json", 
							data:{sick:d},
							success: function(d){
								if(d.success){
									$("#commesCom").html("保存成功").show();
									setTimeout(function(){
										$("#commesCom").html("").hide();
									},1500);
								}
				    		},
				    		error:function(){

				    		}
			          	})
			          }
			    });
			    avalon.scan();
			    $.ajax({ 
					type:"get",
					url: "/sick/info?id="+id,
					dataType: "json", 
					success: function(obj){
						obj.content.in_day = new Date(obj.content.in_day).Format("yyyy-MM-dd");
						obj.content.out_day = new Date(obj.content.out_day).Format("yyyy-MM-dd");
						vmodel.d = $.extend(data,obj.content);
						if(temp.type == "doctor"){
							$.ajax({ 
								type:"get",
								url: "/sick/sickscore?sick_id="+id,
								dataType: "json", 
								success: function(obj){

									vmodel.d = $.extend(vmodel.d.$model,obj.content);
					    		},
					    		error:function(){

					    		}
							}); 
							$.ajax({ 
								type:"get",
								url: "/sick/sickdrugcount?sick_id="+id,
								dataType: "json", 
								success: function(obj){
									var d = obj.content;
									
									vmodel.d = $.extend(vmodel.d.$model,d);
					    		},
					    		error:function(){

					    		}
							});
						}
		    		},
		    		error:function(){

		    		}
				}); 
		});
		
	</script>
</body>
</html>